<element name="yt-video" attributes="videoid">
<template>
  <style>
    @host {
      position: relative;
    }
  </style>
  <div id="container">
  </div>
</template>
<script>
  this.component({
    prototype: {
      videoidChanged: function() {
        //console.log(this.videoid);
        if (this.videoid && this.videoid !== true) {
          if (this.player) {
           this.player.loadVideoById(this.videoid);
          } else {
           this.createPlayer();
          }
        }
      },
      createPlayer: function() {
        if (!window.YT) {
          this.loadYtApi();
          return;
        }
        this.player = new YT.Player(this.$.container, {
          height: '100%',
          width: '100%',
          events: {
            onReady: this.playerReady.bind(this),
            onStateChange: this.playerStateChange.bind(this)
          }
        });
        if (this.playerNode) {
          this.playerNode.hidden = true;
        }
      },
      playerReady: function(inEvent) {
        this.playerNode.hidden = true;
        this.player.loadVideoById(this.videoid);
        this.player.playVideo();
        // make player iframe fittable to this component.
        this.playerNode.style.position = "absolute";
      },
      playerStateChange: function(inEvent) {
        if (inEvent.data == 1) {
          this.playerNode.hidden = false;
        }
      },
      get playerNode() {
        return this.player && this.player.a;
      },
      loadYtApi: function() {
        var s = document.createElement('script');
        s.src = "http://www.youtube.com/player_api";
        document.body.appendChild(s);
      }
    }
  });
</script>
</element>
